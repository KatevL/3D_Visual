<!DOCTYPE html>
<html>

<head>
	<meta charset=utf-8>
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<title>3D factory stages</title>
	<!--Body background image is not supported in HTML5 using CSS instead -->
	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
	<!-- Bootstrap -->
	<script src="js/bootstrap.min.js"></script>
	<link href="css/additionalStyle.css" rel="stylesheet">
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="css/bar2.css" rel="stylesheet">

</head>

<body>
	<script src="js/bundle.js"></script>
	<script src="js/three.js"></script>
	<script src="js/factoryControls.js"></script>
	<script src="js/OBJLoader.js"></script>
	<script src="js/createRooms.js"></script>
	<script src="js/factory.js"></script>
	<script src="js/factory_1_floor.js"></script>
	<script src="js/customer1.js"></script>
	<script src="js/workstation.js"></script>
	<script src="js/wip_shelf.js"></script>
	<script src="js/wip_object.js"></script>
	<script src="js/person.js"></script>
	<script src="js/forklift.js"></script>
	<script src="js/s2s_mqtt.js"></script>
	<script src="js/toilet.js"></script>
	<script src="js/lorry.js"></script>
	<script src="js/shopfloorPerson.js"></script>
	<script src="js/recyclingBin.js"></script>
	<script src="js/shelving.js"></script>
	<script src="js/officeMan.js"></script>
	<script src="js/OfficeFemale.js"></script>
	<script src="js/ShopfloorFem.js"></script>
	<script src="js/shopfloorAltMan.js"></script>
	<script src="js/sfDesk.js"></script>
	<script src="js/urinal.js"></script>
	<script src="js/workstationPC.js"></script>
	<script src="js/officeDeskPC.js"></script>
	<script src="js/standingGreySuit.js"></script>
	<script src="js/sfDeskBeard.js"></script>
	<script src="js/officedeskOccupied.js"></script>
	<script src="js/officedeskOccupiedFem.js"></script>
	<script src="js/vanunload.js"></script>
	<script src="js/shelvingBox.js"></script>
	<script src="js/deskwithPallet.js"></script>
	<script src="js/palletGreyBoxes.js"></script>
	<script src="js/palletBoxes.js"></script>
	<script src="js/customerDeskSell.js"></script>
	<script src="js/sfDeskonPhone.js"></script>
	<script src="js/vandepart.js"></script>
	<script src="js/sfdeskprocessing.js"></script>
	<script src="js/secureStores.js"></script>

<script src="js/dataErase.js"></script>
<script src="js/dePrint.js"></script>
<script src="js/sfdeskPacking.js"></script>
<script src="js/courier.js"></script>

	<h1 class="title">S2S Process 3D factory </h1>


	<div id="container">
		<div id="blocker">
			<div id="instructions">
				<span style="font-size:40px"><br/> Click to tour the factory</span>
			</div>
		</div>
	</div>
	<!--  container for full page -->
		<!-- container for header -->
		<!-- full image overview -->

			<div class="col-md-4">
				<div style="display: table; height: 200px; width:auto; soverflow: hidden;">
					<div style="display: table-cell; vertical-align: middle;">
						<h2 class="introBullet"> <ul>
							<li> Please click tabs 1 to 10 in numerical order to view phone processing steps</li>
		 				 <li> Next, please <a href="s2s_factory_v2.html">CLICK HERE </a>to explore the full size verison </li>
				 <li class="instructions2"> Using the 3D view: </br>W,A,S,D = move,</br>SPACE = Jump, </br>Mousemove = look around Page up for birds eye view </br> Page down for ground level </br>ESCAPE to free cursor</li>
			 </ul> </h2>

					</div>
				</div>
			</div>


		<div class="row">
			<div class="tabbable-panel">
				<div class="tabbable-line">
					<div class="col-md-12">
						<ul class="nav nav-tabs ">
							<li><a href="#get-items" data-toggle="tab" onclick="document.getElementById('mainPic').src='images/fullPictureStoryboard1.jpg'" >1: Get items </a>
							</li>
							<li><a href="#items-arrive" data-toggle="tab" onclick="document.getElementById('mainPic').src='images/fullPictureStoryboard2.jpg'"> 2: Items arrive </a>
							</li>
							<li><a href="#start-processing" data-toggle="tab" onclick="document.getElementById('mainPic').src='images/fullPictureStoryboard3.jpg'">3: Start processing </a>
							</li>
							<li><a href="#locked-unknown-loop" data-toggle="tab" onclick="document.getElementById('mainPic').src='images/fullPictureStoryboard4.jpg'">4: Locked/unknown loop </a>
							</li>
							<li><a href="#functional-test" data-toggle="tab" onclick="document.getElementById('mainPic').src='images/fullPictureStoryboard5.jpg' ">5: Functional test </a>
							</li>
							<li><a href="#data-erasure" data-toggle="tab" onclick="document.getElementById('mainPic').src='images/fullPictureStoryboard6.jpg'">6: Data erasure</a>
							</li>
							<li><a href="#value-estimate" data-toggle="tab" onclick="document.getElementById('mainPic').src='images/fullPictureStoryboard7.jpg'">7: Value estimate</a>
							</li>
							<li><a href="#blind-bidding" data-toggle="tab" onclick="document.getElementById('mainPic').src='images/fullPictureStoryboard8.jpg'">8: Blind bidding</a>
							</li>
							<li><a href="#sold" data-toggle="tab" onclick="document.getElementById('mainPic').src='images/fullPictureStoryboard9.jpg'">9: Sold</a>
							</li>
							<li><a href="#sale-complete" data-toggle="tab" onclick="document.getElementById('mainPic').src='images/fullPictureStoryboard10.jpg'">10: Sale complete</a>
							</li>
							</li>
						</ul>
					</div>
				</div>
				<div class="tab-content">

					<div class="tab-pane active" id="get-items" height="100px" width="100px">
						<!--	<asp:ValidationSummary runat="server" CssClass="text-danger" /> -->
						<div class="row">
							<div class="col-md-6 col-md-offset-1">
								<img class="zoomed" src="images/story1.jpg" alt="steps 1 - 3"></img>
							</div>
						</div>

					</div>

					<div class="tab-pane" id="items-arrive">
						<!--	<asp:ValidationSummary runat="server" CssClass="text-danger" /> -->
						<div class="row">
							<div class="col-md-6 col-md-offset-1">
								<img class="zoomed" src="images/story2.jpg" alt="steps 4-6"> </img>
							</div>
						</div>

					</div>

					<div class="tab-pane" id="start-processing">
						<!--	<asp:ValidationSummary runat="server" CssClass="text-danger" /> -->
						<div class="row">
							<div class="col-md-6 col-md-offset-1">
								<img class="zoomed" src="images/story3.jpg" alt="initial stages processing phones"></img>
							</div>
						</div>

					</div>

					<div class="tab-pane" id="locked-unknown-loop">
						<!--	<asp:ValidationSummary runat="server" CssClass="text-danger" /> -->
						<div class="row">
							<div class="col-md-6 col-md-offset-1">
								<img class="zoomed" src="images/story4.jpg" alt="steps if phone unknown or unlocked">
								</img>
							</div>
						</div>

					</div>

					<div class="tab-pane" id="functional-test">
						<!--	<asp:ValidationSummary runat="server" CssClass="text-danger" /> -->
						<div class="row">
							<div class="col-md-6 col-md-offset-1">
								<img class="zoomed" src="images/story5.jpg" alt="functional test"></img>
							</div>
						</div>

					</div>

					<div class="tab-pane" id="data-erasure">
						<!--	<asp:ValidationSummary runat="server" CssClass="text-danger" /> -->
						<div class="row">
							<div class="col-md-6 col-md-offset-1">
								<img class="zoomed" src="images/story6.jpg" alt="Data erasure"></img>
							</div>
						</div>

					</div>

					<div class="tab-pane" id="value-estimate">
						<!--	<asp:ValidationSummary runat="server" CssClass="text-danger" /> -->
						<div class="row">
							<div class="col-md-6 col-md-offset-1">
								<img class="zoomed" src="images/story7.jpg" alt="Value estimate"></img>
							</div>
						</div>

					</div>

					<div class="tab-pane" id="blind-bidding">
						<!--	<asp:ValidationSummary runat="server" CssClass="text-danger" /> -->
						<div class="row">
							<div class="col-md-5 col-md-offset-1">
								<img class="zoomed" src="images/story8.jpg" alt="Blind bidding"></img>
							</div>


						</div>
					</div>


					<div class="tab-pane" id="sold">
						<!--	<asp:ValidationSummary runat="server" CssClass="text-danger" /> -->
						<div class="row">
							<div class="col-md-6 col-md-offset-1">
								<img class="zoomed" src="images/story9.jpg" alt="sold"></img>
							</div>
						</div>
						<div class="row" align="right">

						</div>
					</div>

					<div class="tab-pane" id="sale-complete">
						<!--	<asp:ValidationSummary runat="server" CssClass="text-danger" /> -->
						<div class="row">
							<div class="col-md-6 col-md-offset-1">
								<img class="zoomed" src="images/story10.jpg" alt="sale complete"></img>
							</div>
						</div>

					</div>

				</div>
			</div>
			<!--
			<div class="row">
				<div class="checkout-wrap col-md-10 col-md-offset-1">
					<ul class="checkout-bar">
						<li class="active"><a href="#get-items" data-toggle="tab">Get items</a>
						</li>
						<li class=""><a href="#items-arrive" data-toggle="tab">Items arrive </a>
						</li>
						<li class=""><a href="#start-processing" data-toggle="tab">Start processing</a>
						</li>
						<li class=""><a href="#locked-unknown-loop" data-toggle="tab">Locked/unknown loop</a>
						</li>
						<li class=""><a href="#functional-test" data-toggle="tab">Functional test</a>
						</li>
						<li class=""><a href="#data-erasure" data-toggle="tab">Data erasure</a>
						</li>
						<li class=""><a href="#value-estimate" data-toggle="tab">Value estimate</a>
						</li>
						<li class=""><a href="#blind-bidding" data-toggle="tab">Blind bidding</a>
						</li>
						<li class=""><a href="#sold" data-toggle="tab">Sold</a>
						</li>
						<li class=""><a href="#sale-complete" data-toggle="tab">Sale complete</a>
						</li>
					</ul>
				</div>
			</div> -->
			<!-- script for the checkout bar -->
			<!--	<script>
				$(document).ready(function() {
					$('a[data-toggle="tab"]').on('shown.bs.tab', function(e) {

						var href = $(e.target).attr('href');
						var $curr = $(".checkout-bar  a[href='" + href + "']").parent();

						$('.checkout-bar li').removeClass();

						$curr.addClass("active");
						$curr.prevAll().addClass("visited");


					});
				});
			</script> -->
		</div>

	<script>
		$(document).ready(function() {
			//your code here

			var x = window;

			var camera, scene, renderer;
			var geometry, material, mesh;
			var controls;

			var objects = [];

			var raycaster;

			var blocker = document.getElementById('blocker');
			var instructions = document.getElementById('instructions');

			var god = true;

			// http://www.html5rocks.com/en/tutorials/pointerlock/intro/

			var havePointerLock = 'pointerLockElement' in document || 'mozPointerLockElement' in document || 'webkitPointerLockElement' in document;

			if (havePointerLock) {

				var element = document.body;

				var pointerlockchange = function(event) {

					if (document.pointerLockElement === element || document.mozPointerLockElement === element || document.webkitPointerLockElement === element) {

						controlsEnabled = true;
						controls.enabled = true;

						blocker.style.display = 'none';

					} else {

						controls.enabled = false;

						blocker.style.display = '-webkit-box';
						blocker.style.display = '-moz-box';
						blocker.style.display = 'box';

						instructions.style.display = '';

					}

				};

				var pointerlockerror = function(event) {

					instructions.style.display = '';

				};

				// Hook pointer lock state change events
				document.addEventListener('pointerlockchange', pointerlockchange, false);
				document.addEventListener('mozpointerlockchange', pointerlockchange, false);
				document.addEventListener('webkitpointerlockchange', pointerlockchange, false);

				document.addEventListener('pointerlockerror', pointerlockerror, false);
				document.addEventListener('mozpointerlockerror', pointerlockerror, false);
				document.addEventListener('webkitpointerlockerror', pointerlockerror, false);

				instructions.addEventListener('click', function(event) {

					instructions.style.display = 'none';

					// Ask the browser to lock the pointer
					element.requestPointerLock = element.requestPointerLock || element.mozRequestPointerLock || element.webkitRequestPointerLock;

					if (/Firefox/i.test(navigator.userAgent)) {

						var fullscreenchange = function(event) {

							if (document.fullscreenElement === element || document.mozFullscreenElement === element || document.mozFullScreenElement === element) {

								document.removeEventListener('fullscreenchange', fullscreenchange);
								document.removeEventListener('mozfullscreenchange', fullscreenchange);

								element.requestPointerLock();
							}

						};

						document.addEventListener('fullscreenchange', fullscreenchange, false);
						document.addEventListener('mozfullscreenchange', fullscreenchange, false);

						element.requestFullscreen = element.requestFullscreen || element.mozRequestFullscreen || element.mozRequestFullScreen || element.webkitRequestFullscreen;

						element.requestFullscreen();

					} else {

						element.requestPointerLock();

					}

				}, false);

			} else {

				instructions.innerHTML = 'Your browser doesn\'t seem to support Pointer Lock API';

			}

			init();



			var controlsEnabled = false;

			var moveForward = false;
			var moveBackward = false;
			var moveLeft = false;
			var moveRight = false;
			var canJump = false;

			var prevTime = performance.now();
			var velocity = new THREE.Vector3();

			/*List of all workstations as a custom object, see workstation.js*/
			var factoryWorkstations = [];
			var factoryWorkstationPCs = [];
			var officedeskwithPCs = [];
			var CustomerDesks = [];
			var dataErases = [];
			var sfdeskPackings = [];

			/*List of all Persons as a custom objects*/
			var factoryPersons = [];
			var shopfloorPersons = [];
			var OfficeMen = [];
			var OfficeFems = [];
			var ShopfloorFems = [];
			var shopfloorAltMen = [];
			var sfdeskprocessings = [];
			var greySuits = [];
			var sfdeskonPhones = [];
			/*List of all Forklifts as a custom object, see forklift.js*/
			var factoryForklifts = [];
			var vandeparts = [];
			var vanunloads = [];
			var factoryBlueShelving = [];

			var factorysecureStores=[];
var couriers=[];

			var factoryrecyclingBins = [];
			/*List of all cubes as THREE.Mesh*/
			var factoryWIP = [];
			/*List of all toilets as custom object, see toilet.js*/
			var factorytoilets = [];
			/*List of all shelves as a custom object, see wip_shelf.js*/
			var factoryShelving = [];
			//lists all lorries in factory as custom object, see lorry.js
			var factoryLorries = [];

			function addNewStation(ws) {
				scene.add(ws.object);
				objects.push(ws.object);
				factoryWorkstations.push(ws);
				console.log('Workstation: -' + ws.id + '-, has been added');

				var newShelf = createShelf(ws, ws.id);
				scene.add(newShelf.three_obj);
				factoryShelving.push(newShelf);
			}

			function addNewStationPC(wsPC) {
				scene.add(wsPC.object);
				objects.push(wsPC.object);
				factoryWorkstations.push(wsPC);
				console.log('WorkstationPC: -' + wsPC.id + '-, has been added');

				var newShelfPC = createShelf(wsPC, wsPC.id);
				scene.add(newShelf.three_obj);
				factoryShelving.push(newShelfPC);
			}

			function addNewsfdeskBeard(sfDB) {
				scene.add(sfDB.object);
				objects.push(sfDB.object);
				factoryWorkstations.push(sfDB);
				console.log('Workstation: -' + sfDB.id + '-, has been added');

				var newShelf = createShelf(sfDB, sfDB.id);
				scene.add(newShelf.three_obj);
				factoryShelving.push(newShelf);
			}

			//NOTE KvL person blender model credits not required!
			function addNewsfdesk(sfD) {
				scene.add(sfD.object);
				objects.push(sfD.object);

			}
			//NOTE KvL person blender model credits not required!
			function addNewcourier(cour) {
				scene.add(cour.object);
				objects.push(cour.object);

			}
			//NOTE KvL person blender model credits not required!
			function addNewdataErase(de) {
				scene.add(de.object);
				objects.push(de.object);

			}
			//NOTE KvL person blender model credits not required!
			function addNewsfdeskprocessing(sfDp) {
				scene.add(sfDp.object);
				objects.push(sfDp.object);

			}
			//NOTE KvL person blender model credits not required!
			function addNewvandepart(vanD) {
				scene.add(vanD.object);
				objects.push(vanD.object);

			}
			//NOTE KvL person blender model credits not required uses deskwithPallet.JS!
			function addNewsDeskChairManBoxStood(ManBox) {
				scene.add(ManBox.object);
				objects.push(ManBox.object);

			}
			//NOTE KvL person blender model credits not required uses sfDeskonPhone.js!
			function addNewssfDeskonPhone(sfPhone) {
				scene.add(sfPhone.object);
				objects.push(sfPhone.object);

			}
			//NOTE desk json figure  blender  KvL
			function addNewOfficeDeskPC(oDpc) {
				scene.add(oDpc.object);
				objects.push(oDpc.object);
				//factoryPerson.push(ps);
				//console.log('Person: - ' + person.id + '-, has been added');

			}
			//NOTE desk json figure  blender  KvL
			function addNewCustomerDesk(cDesk) {
				scene.add(cDesk.object);
				objects.push(cDesk.object);

			}
			//NOTE desk json figure  blender  KvL
			function addNewPalletBrown(PalB) {
				scene.add(PalB.object);
				objects.push(PalB.object);
				//factoryPerson.push(ps);
				//console.log('Person: - ' + person.id + '-, has been added');

			}
			//NOTE desk json figure  blender  KvL
			function addNewPalletGrey(PalG) {
				scene.add(PalG.object);
				objects.push(PalG.object);
				//factoryPerson.push(ps);
				//console.log('Person: - ' + person.id + '-, has been added');

			}

			function addNewofficedeskOccupied(oDOc) {
				scene.add(oDOc.object);
				objects.push(oDOc.object);
				//factoryPerson.push(ps);
				//console.log('oDOc: - ' + oDOc.id + '-, has been added');

			}

			function addNewofficedeskOccupiedFem(oDOcF) {
				scene.add(oDOcF.object);
				objects.push(oDOcF.object);
				//factoryPerson.push(ps);
				//console.log('oDOc: - ' + oDOc.id + '-, has been added');

			}
			//NOTE human json figure from blender and MakeHuman.org. KvL
			function addNewOfficeMan(oMan) {
				scene.add(oMan.object);
				objects.push(oMan.object);
				//factoryPerson.push(ps);
				//console.log('Person: - ' + person.id + '-, has been added');

			}
			//NOTE human json figure from blender and MakeHuman.org. KvL
			function addNewShopfloorFem(SfFem) {
				scene.add(SfFem.object);
				objects.push(SfFem.object);
			}
			//NOTE KvL toilet json from blender credits not required
			function addNewToilet(loo) {
				scene.add(loo.object);
				objects.push(loo.object);
				//factorytoilets.push(ps);
				//console.log('toilet: - ' + toilet.id + '-, has been added');

			}

			//NOTE human json figure from blender and MakeHuman.org. KvL
			function addNewOfficeFem(oFem) {
				scene.add(oFem.object);
				objects.push(oFem.object);
				//factoryPerson.push(ps);
				//console.log('Person: - ' + person.id + '-, has been added');

			}

			//NOTE human json figure from blender and MakeHuman.org. KvL
			function addNewStandingGreySuit(GreyS) {
				scene.add(GreyS.object);
				objects.push(GreyS.object);
				//factoryPerson.push(ps);
				//console.log('Person: - ' + person.id + '-, has been added');

			}
			//NOTE KvL person blender model credits not required!
			function addNewShopFloorPerson(sfp) {
				scene.add(sfp.object);
				objects.push(sfp.object);

			}
			//NOTE KvL forklift blender model credits not required!
			function addNewForklift(fk) {
				scene.add(fk.object);
				objects.push(fk.object);
				//factoryForklifts.push(ps);
				//console.log('Forklift: - ' + forklift.id + '-, has been added');
			}


			//NOTE KvL  blender model credits not required!
			function addNewBlueShelving(blueS) {
				scene.add(blueS.object);
				objects.push(blueS.object);

			}
			//NOTE KvL  blender model credits not required!
			function addNewsfdeskPacking(sfdP) {
				scene.add(sfdP.object);
				objects.push(sfdP.object);

			}
			//NOTE KvL  blender model credits not required!
			function addNewsecureStores(secure) {
				scene.add(secure.object);
				objects.push(secure.object);

			}
			//NOTE KvL  blender model credits not required!
			function addNewsfdePrint(print) {
				scene.add(print.object);
				objects.push(print.object);

			}

			function addNewBlueShelvingBox(blueSBx) {
				scene.add(blueSBx.object);
				objects.push(blueSBx.object);

			}
			//NOTE KvL recycling bin blender model credits not required!
			function addNewrecycleBin(bin) {
				scene.add(bin.object);
				objects.push(bin.object);

			}
			//NOTE KvL toilet json from blender credits not required
			function addNewToilet(loo) {
				scene.add(loo.object);
				objects.push(loo.object);
				//factorytoilets.push(ps);
				//console.log('toilet: - ' + toilet.id + '-, has been added');

			}
			//NOTE KvL toilet json from blender credits not required
			function addNewurinal(Urin) {
				scene.add(Urin.object);
				objects.push(Urin.object);
				//factorytoilets.push(ps);
				//console.log('toilet: - ' + toilet.id + '-, has been added');

			}
			//NOTE KvL toilet json from blender credits not required
			function addNewshopfloorAltMan(sfAltMan) {
				scene.add(sfAltMan.object);
				objects.push(sfAltMan.object);
				//factorytoilets.push(ps);
				//console.log('toilet: - ' + toilet.id + '-, has been added');

			}
			//NOTE KvL lorry blender model credits not required!
			function addNewLorry(lry) {
				scene.add(lry.object);
				objects.push(lry.object);
				//factoryLorries.push(ps);
				//console.log('Lorry: - ' + Lorry.id + '-, has been added');
			}

			function addNewvanunload(vanUn) {
				scene.add(vanUn.object);
				objects.push(vanUn.object);
				//factoryLorries.push(ps);
				//console.log('Lorry: - ' + Lorry.id + '-, has been added');
			}

			function addNewWIP(id) {
				var _newBox = createNewWIPObj(id);
				factoryWIP.push(_newBox);
				scene.add(_newBox.three_obj);
				scene.add(_newBox.text);
				console.log('New Cube: -' + id + '-, has been added');
			};

			function assignWIPtoWS(cube, ws) {

				moveWIPObj(ws.cube.cube_x, ws.cube.cube_y, ws.cube.cube_z, cube);

			};

			function fakeAddBox() {
				addNewWIP(factoryWIP.length);
				var _recentIndex = factoryWIP.length - 1;

				var _randomWS = Math.floor(Math.random() * ((factoryWorkstations.length - 1) + 1));

				assignWIPtoWS(factoryWIP[_recentIndex], factoryWorkstations[_randomWS]);
				//addText('yo Kate', factoryWIP[_recentIndex].position.x, factoryWIP[_recentIndex].position.y, factoryWIP[_recentIndex].position.z);
			};

			function fakeMovedBox(boxID, wsID, shelfSlotID) {

				var cubeToMove;
				var shelfToGoTo;

				for (var i = 0; i < factoryWIP.length; i++) {
					if (factoryWIP[i].id == boxID) {
						cubeToMove = factoryWIP[i];
					}
				};

				for (var i = 0; i < factoryShelving.length; i++) {
					if (factoryShelving[i].assoicatedWS == wsID) {
						shelfToGoTo = factoryShelving[i];
					}
				};

				var sSlotx;
				var sSloty;
				var sSlotz;

				for (var i = 0; i < shelfToGoTo.slots.length; i++) {
					if (shelfToGoTo.slots[i].id == shelfSlotID) {
						sSlotx = shelfToGoTo.slots[i].centre.x;
						sSloty = shelfToGoTo.slots[i].centre.y;
						sSlotz = shelfToGoTo.slots[i].centre.z;
					}
				}

				var newX = shelfToGoTo.three_obj.position.x + sSlotx;
				var newY = shelfToGoTo.three_obj.position.y + sSloty;
				var newZ = shelfToGoTo.three_obj.position.z + sSlotz;


				moveWIPObj(newX, newY, newZ, cubeToMove);

			};

			function addText(text, x, y, z, rotate) {

				var cv = document.createElement("canvas");
				var xc = cv.getContext("2d");
				cv.width = 300;
				cv.height = 300;
				//xc.shadowColor = "#000";
				//xc.shadowBlur = 1;
				xc.fillStyle = "#ff0066";
				xc.font = "20pt arial bold";
				xc.fillText(text, 10, 64);

				var xm = new THREE.MeshBasicMaterial({
					map: new THREE.Texture(cv),
					transparent: true
				});
				xm.map.needsUpdate = true;

				var mesh = new THREE.Mesh(new THREE.PlaneGeometry(20, 20), xm);
				mesh.material.side = THREE.DoubleSide;
				mesh.rotateY(rotate);
				mesh.position.x = x - 10;
				mesh.position.y = y;
				mesh.position.z = z;
				mesh.doubleSided = true;
				scene.add(mesh);

			}

			function addBigText(text, x, y, z, rotate) {

				var cv = document.createElement("canvas");
				var xc = cv.getContext("2d");
				var _newWidth = 20;
				cv.height = (_newWidth / cv.width)* cv.height;
				cv.width = _newWidth;
				//cv.width = 1000;
				//cv.height = 400;
				//xc.shadowColor = "#000";
				//xc.shadowBlur = 1;
				xc.fillStyle = "#cc0066";
				xc.font = "80pt arial bold";
				xc.align="centre";
				xc.fillText(text, 10, 80);

				var xm = new THREE.MeshBasicMaterial({
					map: new THREE.Texture(cv),
					transparent: true
				});
				xm.map.needsUpdate = true;

				var mesh = new THREE.Mesh(new THREE.PlaneGeometry(20, 20), xm);
				mesh.material.side = THREE.DoubleSide;
				mesh.rotateY(rotate);
				mesh.position.x = x - 10;
				mesh.position.y = y;
				mesh.position.z = z;
				mesh.doubleSided = true;
				scene.add(mesh);

			}
			var marioHeight = 1.7 * meter;

			function changeHeight() {
				var _1stFloorHeight = 4.7 * meter;
				if (marioHeight == _1stFloorHeight) {
					marioHeight = 1.7 * meter;
				} else {
					marioHeight = _1stFloorHeight;
				}

				controls.getObject().position.y = marioHeight;

			}

			function goToPosition(_x, _y, _z) {

				controls.getObject().position.y = _y * meter;

				controls.getObject().position.x = _x * meter;

				controls.getObject().position.z = _z * meter;
				animate();
				//controls.getObject().translateX(velocity.x * delta);
				//controls.getObject().translateY(velocity.y * delta);
				//controls.getObject().translateZ(velocity.z * delta);
			}


			function processJSONRoute(_fileName) {
				controlsEnabled = false;
				var json = (function() {
					var json = null;
					$.ajax({
						'async': true,
						'global': false,
						'url': "json-routes/" + _fileName,
						'dataType': "json",
						'success': function(data) {
							var instructions = data;

							//go to start position
							goToPosition(instructions.route.start.x, instructions.route.start.y, instructions.route.start.z);

							sleep(1500);

							///for each movement in the list of instructions
							var _loopNo = instructions.route.path.length;
							asyncLoop(_loopNo, function(loop) {
									var i = loop.iteration();
									var _x = instructions.route.path[i].movement.x * meter;
									var _y = instructions.route.path[i].movement.y * meter;
									var _z = instructions.route.path[i].movement.z * meter;
									var _t = instructions.route.path[i].movement.t;
									moveToPosition(_x, _y, _z, _t, function(result) {
										console.log('x: ' + controls.getObject().position.x + '-- m: ' + controls.getObject().position.x / meter);
										console.log('y: ' + controls.getObject().position.y + '-- m: ' + controls.getObject().position.y / meter);
										console.log('z: ' + controls.getObject().position.z + '-- m: ' + controls.getObject().position.z / meter);
										// log the iteration
										console.log(loop.iteration());

										// Okay, for cycle could continue
										loop.next();
									})
								},
								function() {
									console.log('cycle ended');
									console.log('x: ' + controls.getObject().position.x + '-- m: ' + controls.getObject().position.x / meter);
									console.log('y: ' + controls.getObject().position.y + '-- m: ' + controls.getObject().position.y / meter);
									console.log('z: ' + controls.getObject().position.z + '-- m: ' + controls.getObject().position.z / meter);
									// log the iteration
								}
							);


						}
					});


				})();

			}

			function getTDistance(newP, oldP) {

				var _newP = parseFloat(newP);
				var _oldP = parseFloat(oldP);

				var diff = Math.abs(_oldP - _newP);

				if (_oldP > _newP) diff = diff * -1;

				return diff;

			}

			function sleep(ms) {
				var start = new Date().getTime(),
					expire = start + ms;
				while (new Date().getTime() < expire) {}
				return;
			}

			//DISTANCE IN PIXELS
			function moveToPosition(_nx, _ny, _nz, timeMs, callback) {


				var _totalTimeMs = parseFloat(timeMs);

				//every '_interval' the character should move
				var _interval = 50;

				//speed
				var _speedMeters = 2;
				//pixels per milliseconds, 25 pixels = 1m
				var _speed = (2 * 25) / 1000;

				//New positions
				var _newX = _nx;
				var _newY = _ny;
				var _newZ = _nz;
				//Existing positions
				var _existX = controls.getObject().position.x;
				var _existY = controls.getObject().position.y;
				var _existZ = controls.getObject().position.z;
				//Is the position a change?
				var xChange = true;
				var yChange = true;
				var zChange = true;

				//Distance in pixels (converted before this function)
				var _distanceX = getTDistance(_newX, _existX);
				var _distanceY = getTDistance(_newY, _existY);
				var _distanceZ = getTDistance(_newZ, _existZ);

				//Time to travel @ _speed
				var _miliSOfMovmentX = Math.abs(_distanceX / _speed);
				var _miliSOfMovmentY = Math.abs(_distanceY / _speed);
				var _miliSOfMovmentZ = Math.abs(_distanceZ / _speed);

				//Number of steps (miliseconds / miliseconds)
				var _totalStepsX = parseFloat(_miliSOfMovmentX / _interval);
				var _totalStepsY = parseFloat(_miliSOfMovmentY / _interval);
				var _totalStepsZ = parseFloat(_miliSOfMovmentZ / _interval);

				var _stepX = parseFloat(_distanceX / _totalStepsX);
				var _stepY = parseFloat(_distanceY / _totalStepsY);
				var _stepZ = parseFloat(_distanceZ / _totalStepsZ);

				console.log(getTDistance(_newX, _existX) + '/' + _totalTimeMs + ' / ' + _interval);
				var startTime = new Date().getTime();
				var count = 0;
				var xStop = false;
				var yStop = false;
				var zStop = false;

				var _stepCountX = 0;
				var _stepCountY = 0;
				var _stepCountZ = 0;
				console.log('x:' + _totalStepsX + ' y: ' + _totalStepsY + ' z: ' + _totalStepsZ);
				console.log('xstep:' + _stepX + ' ystep: ' + _stepY + ' zstep: ' + _stepZ);
				//this function fill fire every '_interval' ms

				var timeXStopMoving = new Date().getTime() + _miliSOfMovmentX;
				var timeYStopMoving = new Date().getTime() + _miliSOfMovmentY;
				var timeZStopMoving = new Date().getTime() + _miliSOfMovmentZ;

				var _now = new Date().getTime();
				var _totalStop = new Date().getTime() + _totalTimeMs;


				var interval = setInterval(function() {

					var _now = new Date().getTime();

					if (xChange) {
						if (_stepCountX >= _totalStepsX) {
							xStop = true;
						} else {
							controls.getObject().position.x = parseFloat(controls.getObject().position.x) + parseFloat(_stepX);
							_stepCountX++;
						}
					}
					if (yChange) {
						if (_stepCountY >= _totalStepsY) {
							yStop = true;
						} else {
							controls.getObject().position.y = parseFloat(controls.getObject().position.y) + parseFloat(_stepY);
							_stepCountY++;
						}
					}
					if (zChange) {
						if (_stepCountZ >= _totalStepsZ) {
							zStop = true;
						} else {
							controls.getObject().position.z = parseFloat(controls.getObject().position.z) + parseFloat(_stepZ);
							_stepCountZ++
						}
					}
					if (xStop && yStop && zStop) {
						if (_now > _totalStop) {
							clearInterval(interval);
							callback({
								status: 'complete'
							});
							return;
						}
					}
					count++

				}, _interval);

			}



			function asyncLoop(iterations, func, callback) {
				var index = 0;
				var done = false;
				var loop = {
					next: function() {
						if (done) {
							return;
						}

						if (index < iterations) {
							index++;
							func(loop);

						} else {
							done = true;
							callback();
						}
					},

					iteration: function() {
						return index - 1;
					},

					break: function() {
						done = true;
						callback();
					}
				};
				loop.next();
				return loop;
			}

			function init() {

				camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 10000);

				scene = new THREE.Scene();
				//scene.fog = new THREE.Fog(0xffffff, 0, 750);

				var light = new THREE.HemisphereLight(0x000000, 0xffffff, 0.6);
				light.position.set(2000, 20000, 2000);
				scene.add(light);

				var directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
				directionalLight.position.set(0, 1, 0);
				scene.add(directionalLight);

				controls = new THREE.PointerLockControls(camera);
				scene.add(controls.getObject());

				initKeyStrokes();



				raycaster = new THREE.Raycaster();

				returnFactory(function(_building) {
					for (var i = 0; i < _building.length; i++) {
						scene.add(_building[i]);
						objects.push(_building[i]);
					}

					returnFirstFloorFactory(function(_building) {
						for (var i = 0; i < _building.length; i++) {
							scene.add(_building[i]);
							objects.push(_building[i]);
						}
						//attempt to add customer building KvL 11.1.2017
						returnCust1(function(_building) {
							for (var i = 0; i < _building.length; i++) {
								scene.add(_building[i]);
								objects.push(_building[i]);
							}

							//4 desks in phoneRoom location is (x position, y position, Z position, rotation in y, id, addNewNamehere)
//toilet entry to processing room
addBigText("Processing Room", -29.36*meter, 2*meter, 14.9* meter, (-Math.PI));
							createWorkstation(-30 * meter, 0, 4 * meter, 0, '0_refurbD1', addNewStation);
							createWorkstation(-30 * meter, 0, 8 * meter, 0, '0_refurbD2', addNewStation);
							createWorkstation(-30 * meter, 0, 10 * meter, 0, '0_refurbD2', addNewStation);

							createsfDeskBeard(-30 * meter, 0, 12 * meter, 0, '0_refurbD3', addNewsfdeskBeard);

addText("On computer", -30.5*meter, 2*meter , 12.5*meter,(Math.PI/2));
							createsfDeskonPhone(-30*meter, 0, 6* meter, 0, '0_refurbd5', addNewssfDeskonPhone);
							addText("On phone", -30.5*meter, 2*meter , 6.5*meter, (Math.PI/2));

							createsfdeskprocessing(-30*meter, 0, 2* meter, 0, '0_refurbd6', addNewsfdeskprocessing);
							addText("Processing items", -30.5*meter, 2*meter , 2*meter, (Math.PI/2));


							createsfdeskPacking(-30*meter, 0, 0* meter, 0, '0_refurbd7', addNewsfdeskPacking);
addText("Packing items", -30.5*meter, 2*meter , 0*meter, (Math.PI/2));
							createBlueShelving(-28.2 * meter, 0, 2 * meter, 0, '0_blueshelf1', addNewBlueShelving);
							createBlueShelving(-28.2 * meter, 0, 4 * meter, 0, '0_blueshelf2', addNewBlueShelving);
							createBlueShelvingBox(-27.9 * meter, 0, 8 * meter, 0, '0_blueshelft3', addNewBlueShelvingBox);

							createBlueShelvingBox(-27.9* meter, 0, 6 * meter, 0, '0_blueshelft3', addNewBlueShelvingBox);
							createsecureStores(-29.9*meter, 0, 10* meter, (-Math.PI), '0_blueshelfwithmMan', addNewsecureStores);
addText("Quarantining items", -28*meter, 2*meter , 10*meter, (-Math.PI/2));

							// customer desks
							createCustomerDesk(-80 * meter, 0, -80 * meter, 0, '0_CustomerDesk', addNewCustomerDesk);
							addText("Customer", -80*meter, 2*meter , -80*meter, (Math.PI/2));

//Data erasure label
addBigText("Data Erasure", -21.68*meter, 2*meter , -2.28*meter, (Math.PI/2));
							// desks in data erasure room

							createdataErase(-24 * meter, 0, 11.1 * meter, (-Math.PI), '0_dataerase2', addNewdataErase);

							addText("Erasing data", -22.5*meter, 2*meter , 11*meter, (-Math.PI/2));
createdePrint(-26.5*meter, 0, 12* meter, (Math.PI/2), '0_dataerasePrint', addNewsfdePrint);
addText("Printing Certificates", -26.5*meter, 2, 12* meter, (Math.PI/2));
							createBlueShelving(-27.3 * meter, 0, 8 * meter, 0, '0_blueshelf1', addNewBlueShelving);
							addText("Temporary storage", -27*meter, 2*meter , 2.5*meter, (Math.PI/2));
							createBlueShelving(-27.3 * meter, 0, 6 * meter, 0, '0_blueshelf2', addNewBlueShelving);
							createBlueShelvingBox(-26.9 * meter, 0, 4 * meter, 0, '0_blueshelft3', addNewBlueShelvingBox);
							createBlueShelvingBox(-26.9 * meter, 0, 2 * meter, 0, '0_blueshelft4', addNewBlueShelvingBox);
							createBlueShelvingBox(-22 * meter, 0, 2 * meter, 0, '0_blueshelft6', addNewBlueShelvingBox);
							createBlueShelvingBox(-26.9 * meter, 0, 2 * meter, 0, '0_blueshelft4', addNewBlueShelvingBox);
							createBlueShelvingBox(-26.9 * meter, 0, 0 * meter, 0, '0_blueshelft6', addNewBlueShelvingBox);
							createBlueShelvingBox(-26.9 * meter, 0, -2 * meter, 0, '0_blueshelft5', addNewBlueShelvingBox);
							createBlueShelvingBox(-22 * meter, 0, 0 * meter, 0, '0_blueshelft5', addNewBlueShelvingBox);

							//recycling bins

							createRecycleBin(-10 * meter, 0, 12 * meter, (-Math.PI/2), '0_bin1', addNewrecycleBin);
							addBigText("Recycling items", -10*meter, 2.5*meter , 12*meter, (-Math.PI));

							// createRecycleBin(-12 * meter, 0, 12 * meter, 0, '0_bin1', addNewrecycleBin);
							//<!--createRecycleBin(-14 * meter, 0, 12 * meter, 0, '0_bin1', addNewrecycleBin);
							//<!--createRecycleBin(-16 * meter, 0, 12 * meter, 0, '0_bin1', addNewrecycleBin);
							//<!--createRecycleBin(-10 * meter, 0, 10 * meter, 0, '0_bin1', addNewrecycleBin);
							//<!--createRecycleBin(-12 * meter, 0, 10 * meter, 0, '0_bin1', addNewrecycleBin);
							//<!--createRecycleBin(-14 * meter, 0, 10 * meter, 0, '0_bin1', addNewrecycleBin);
							//<!--createRecycleBin(-16 * meter, 0, 10 * meter, 0, '0_bin1', addNewrecycleBin);
							//createShopFloorPerson(-10 * meter, 0, 13.3 * meter, 0, '0_shopfloorBluemanBin1', addNewShopFloorPerson);
							//createshopfloorAltMan(-12 * meter, 0, 13.3 * meter, 0, '0_shopfloorAltMan1atBin2', addNewshopfloorAltMan);

							//NOTE CAN ONLY BE ADDED WHERE THERE ARE NO UPSTAIRS OR IT CAUSES A CLASH (uniforms.specular.value = material.specular;) shelving
							// stores - not secure, top wall 3 shelves.
							addBigText("Stores", -2.6*meter, 2*meter , 30.8*meter, (-Math.PI));
							createBlueShelvingBox(12.2 * meter, 0, 32.2 * meter, 0, '0_blueshelf1', addNewBlueShelvingBox);
							createBlueShelving(12.2 * meter, 0, 35.2 * meter, 0, '0_blueshelf2', addNewBlueShelving);
							createBlueShelving(12.2 * meter, 0, 38.2 * meter, 0, '0_blueshelft3', addNewBlueShelving);
							// stores - not secure, outer wall
							createBlueShelving(10 * meter, 0, 39.8 * meter, (-Math.PI / 2), '0_blueshelf4', addNewBlueShelving);
							createBlueShelvingBox(7 * meter, 0, 40.5 * meter, (-Math.PI / 2), '0_blueshelf5', addNewBlueShelvingBox);
							createBlueShelving(4 * meter, 0, 39.8 * meter, (-Math.PI / 2), '0_blueshel6', addNewBlueShelving);
							createBlueShelvingBox(1 * meter, 0, 40.5 * meter, (-Math.PI / 2), '0_blueshelf7', addNewBlueShelvingBox);
							createBlueShelvingBox(-2 * meter, 0, 40.5 * meter, (-Math.PI / 2), '0_blueshelf8', addNewBlueShelvingBox);
							createBlueShelving(-5 * meter, 0, 39.8 * meter, (-Math.PI / 2), '0_blueshelf9', addNewBlueShelving);
							// stores - not secure,centre shelving racks
addBigText("Secure Stores",-7*meter, 2* meter, 35.82*meter, (Math.PI/2));
							createBlueShelving(9 * meter, 0, 32.2 * meter, 0, '0_blueshelf10', addNewBlueShelving);
							createBlueShelving(9 * meter, 0, 35.2 * meter, 0, '0_blueshelf11', addNewBlueShelving);
							createBlueShelvingBox(6 * meter, 0, 32.2 * meter, 0, '0_blueshelf12', addNewBlueShelvingBox);
							createBlueShelving(6 * meter, 0, 35.2 * meter, 0, '0_blueshelf13', addNewBlueShelving);
							createBlueShelvingBox(3 * meter, 0, 32.2 * meter, 0, '0_blueshelf14', addNewBlueShelvingBox);
							createBlueShelving(3 * meter, 0, 35.2 * meter, 0, '0_blueshelf15', addNewBlueShelving);
							createBlueShelving(0 * meter, 0, 32.2 * meter, 0, '0_blueshelf16', addNewBlueShelving);
							createBlueShelving(0 * meter, 0, 35.2 * meter, 0, '0_blueshelf17', addNewBlueShelving);
							//stores - not secure,shelving to right of door

							createBlueShelving(-5 * meter, 0, 32.2 * meter, (-Math.PI / 2), '0_blueshelf18', addNewBlueShelving);
addText("Stock taking",4 * meter, 2* meter, 33 * meter, (-Math.PI/2) );
							createShopfloorFem(4 * meter, 0, 33 * meter, (-Math.PI / 2), '0_ShopfloorFem1', addNewShopfloorFem);
							//stores secure cage
							createsecureStores(-9.3 * meter, 0, 38 * meter, (Math.PI / 2), '0_secureStore1', addNewsecureStores);
addText("Securing items",-9.3 * meter, 2*meter, 38 * meter, (-Math.PI));
							createBlueShelving(-12.2 * meter, 0, 39.8 * meter, (-Math.PI / 2), '0_blueshelf20', addNewBlueShelving);
							createBlueShelving(-15.2 * meter, 0, 39.8 * meter, (-Math.PI / 2), '0_blueshelf21', addNewBlueShelving);
							createBlueShelvingBox(-12.2 * meter, 0, 36.8 * meter, (-Math.PI / 2), '0_blueshelf14', addNewBlueShelvingBox);
							createBlueShelvingBox(-15.2 * meter, 0, 36.8 * meter, (-Math.PI / 2), '0_blueshelf14', addNewBlueShelvingBox);
							createBlueShelvingBox(-9.3 * meter, 0, 34.2 * meter, (-Math.PI / 2), '0_blueshelf14', addNewBlueShelvingBox);
							createBlueShelvingBox(-12.2 * meter, 0, 34.2 * meter, (-Math.PI / 2), '0_blueshelf14', addNewBlueShelvingBox);
							createBlueShelvingBox(-15.2 * meter, 0, 34.2 * meter, (-Math.PI / 2), '0_blueshelf14', addNewBlueShelvingBox);
							createBlueShelvingBox(-9.3 * meter, 0, 32 * meter, (-Math.PI / 2), '0_blueshelf14', addNewBlueShelvingBox);
							createBlueShelvingBox(-12.2 * meter, 0, 32 * meter, (-Math.PI / 2), '0_blueshelf14', addNewBlueShelvingBox);
							createBlueShelvingBox(-15.2 * meter, 0, 32 * meter, (-Math.PI / 2), '0_blueshelf14', addNewBlueShelvingBox);

							//shopfloor person stores
							createShopfloorFem(10 * meter, 0, 33 * meter, 0, '0_shopfloorperson1', addNewShopfloorFem);
							addText("Stock taking",10 * meter, 2* meter, 33 * meter, (-Math.PI/2) );

							//blue shelving refurbRoom
							//createBlueShelving(-28 * meter, 0, 6 * meter, 0, '0_shelving1', addNewBlueShelving);
							//forklift near bays
							createForklift(-18 * meter, 0, -30 * meter, (-Math.PI / 2), '0_forklift1', addNewForklift);
							addBigText("Forklift",-18 * meter, 2.5*meter, -30 * meter, (Math.PI/2));// booking in desk
							createDeskChairManBoxStood(0 * meter, 0, -38.5 * meter, (-Math.PI / 2), '0_bookingInDesk', addNewsDeskChairManBoxStood);

							// pallets in waiting areas
							addText("Goods waiting",0 * meter, 2.5*meter, -16 * meter, (Math.PI/2));// booking in desk

							createPalletBrown(0 * meter, 0, -20 * meter, (-Math.PI), '0_pallet1', addNewPalletBrown);
							createPalletBrown(0 * meter, 0, -18 * meter, 0, '0_pallet2', addNewPalletBrown);
							createPalletBrown(0 * meter, 0, -16 * meter, (-Math.PI / 2), '0_pallet2', addNewPalletBrown);
							createPalletBrown(0 * meter, 0, -14 * meter, (Math.PI), '0_pallet2', addNewPalletBrown);
							createPalletBrown(0 * meter, 0, -22 * meter, 0, '0_pallet2', addNewPalletBrown);
							addText("Goods waiting",-4 * meter, 2.5*meter, -16 * meter, (Math.PI/2));// booking in desk

							createPalletGrey(-4 * meter, 0, -20 * meter, (-Math.PI), '0_pallet3', addNewPalletGrey);
							createPalletGrey(-4 * meter, 0, -18 * meter, (Math.PI / 2), '0_pallet3', addNewPalletGrey);
							createPalletGrey(-4 * meter, 0, -16 * meter, 0, '0_pallet3', addNewPalletGrey);
							createPalletGrey(-4 * meter, 0, -14 * meter, (-Math.PI / 2), '0_pallet3', addNewPalletGrey);
							createPalletGrey(-4 * meter, 0, -22 * meter, (Math.PI), '0_pallet3', addNewPalletGrey);

							// lorry in bay 1
							createLorry(23 * meter, 0, -31.5 * meter, (-Math.PI / 2), '0_lorryBay1', addNewLorry);
							addBigText("Mobile Shredder",23 * meter, 2*meter, -22* meter, (-Math.PI/2));// booking in desk

							//van in bay 2

							createvanunload(15 * meter, 0, -25 * meter, (Math.PI / 2), '0_vanBay2', addNewvanunload);
							addBigText("Delivered items",15 * meter, 2*meter, -21* meter, (-Math.PI/2));// booking in desk

createvandepart(6*meter, 0, -31.5*meter, (-Math.PI/2), '0_vanBay3', addNewvandepart);
addBigText("Collecting items",6 * meter, 2*meter, -29* meter, (-Math.PI/2));// booking in desk

createcourier(15 * meter, 0, -35 * meter, (Math.PI / 2), '0_courier2', addNewcourier);
addBigText("Courier",15 * meter, 2*meter, -37* meter, (-Math.PI/2));// booking in desk

							//toilets accessed from shopfloor
							addBigText("Toilets",-19.32 * meter, 2*meter, 30.6* meter, (-Math.PI));// booking in desk
							addBigText("Toilets",-27.85 * meter, 2*meter, 23.11* meter, (-Math.PI));// booking in desk

							createToilet(-28.5 * meter, 0, 26.5 * meter, (-Math.PI / 2), '0_toiletShopfloor1', addNewToilet);
							createToilet(-28.5 * meter, 0, 27.5 * meter, (-Math.PI / 2), '0_toiletShopfloor2', addNewToilet);
							createToilet(-28.5 * meter, 0, 28.5 * meter, (-Math.PI / 2), '0_toiletShopfloor3', addNewToilet);
							createToilet(-27.5 * meter, 0, 26.5 * meter, (Math.PI / 2), '0_toiletShopfloor4', addNewToilet);
							createToilet(-27.5 * meter, 0, 27.5 * meter, (Math.PI / 2), '0_toiletShopfloor5', addNewToilet);
							createToilet(-27.5 * meter, 0, 28.5 * meter, (Math.PI / 2), '0_toiletShopfloor6', addNewToilet);


							//toilets accessed from lobby
							createurinal(-23 * meter, 0.7 * meter, 36.2 * meter, (Math.PI / 2), '0_urinaltlobby1', addNewurinal);
							createurinal(-21.8 * meter, 0.7 * meter, 36.2 * meter, (Math.PI / 2), '0_toiletlobby3', addNewToilet);
							createToilet(-20.9 * meter, 0 * meter, 36.6 * meter, (Math.PI * 2), '0_toiletlobby2', addNewToilet);
							createToilet(-19.5 * meter, 0, 33.5 * meter, (-Math.PI), '0_toiletlobby4', addNewToilet);
							createToilet(-20.5 * meter, 0, 33.5 * meter, (-Math.PI), '0_toiletlobby5', addNewToilet);
							createToilet(-21.5 * meter, 0, 33.5 * meter, (-Math.PI), '0_toiletlobby6', addNewToilet);

							//first floor characters
							createOfficeMan(-25 * meter, 3.1 * meter, 4 * meter, 0, '1_officeMan_Manager1', addNewOfficeMan);
							createOfficeFem(-24 * meter, 3 * meter, 15 * meter, 0, '1_officeFem_1', addNewOfficeFem);

							//office desk manager office floor 1
							createOfficeDeskPC(-24 * meter, 3 * meter, 1.5 * meter, 0, '1_officeDeskPC_manager1', addNewOfficeDeskPC);
							// office desks main room
							createOfficeDeskPC(-24 * meter, 3 * meter, 12 * meter, 0, '1_officeDeskPC_sales1', addNewOfficeDeskPC);

							createOfficeDeskPC(-24 * meter, 3 * meter, 6.5 * meter, (-Math.PI / 2), '1_officeDeskPC_sales1', addNewOfficeDeskPC);

							createOfficeDeskOccupied(-24 * meter, 3 * meter, 20 * meter, 0, '1_officeDeskPC_sales1', addNewofficedeskOccupied);



							createOfficeDeskPC(-24 * meter, 3 * meter, 24 * meter, 0, '1_officeDeskPC_sales1', addNewOfficeDeskPC);

							//office desk main room rotated 90 degrees
							createOfficeDeskOccupiedFem(-30 * meter, 3 * meter, 1.5 * meter, (-Math.PI / 2), '1_officeFem_desk1', addNewofficedeskOccupiedFem);
							createOfficeDeskPC(-30 * meter, 3 * meter, 14 * meter, (-Math.PI / 2), '1_officeFem_desk1', addNewOfficeDeskPC);
							createOfficeDeskPC(-30 * meter, 3 * meter, 18 * meter, (-Math.PI / 2), '1_officeFem_desk1', addNewOfficeDeskPC);
							createOfficeDeskPC(-30 * meter, 3 * meter, 22 * meter, (-Math.PI / 2), '1_officeFem_desk1', addNewOfficeDeskPC);
							createOfficeDeskPC(-30 * meter, 3 * meter, 28 * meter, (-Math.PI / 2), '1_officeFem_desk1', addNewOfficeDeskPC);

							renderer = new THREE.WebGLRenderer();
							renderer.setClearColor(0xffffff);
							renderer.setPixelRatio(window.devicePixelRatio);
							//renderer.setSize(window.innerWidth, window.innerHeight);

							container = document.getElementById('container');
							renderer.setSize(container.clientWidth, container.clientHeight);
							container.appendChild(renderer.domElement);

							//document.body.appendChild(renderer.domElement);

							window.addEventListener('resize', onWindowResize, false);
							animate();
						});






					});
				});

			}

			function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize(window.innerWidth, window.innerHeight);

			}

			function animate() {

				var meter = 25;

				var factoryWidth = 100 * meter;
				var factoryLength = 100 * meter;


				var limitZMax = factoryWidth;
				var limitZMin = -factoryWidth;

				var limitXMax = factoryLength;
				var limitXMin = -factoryLength;

				requestAnimationFrame(animate);

				if (controlsEnabled) {

					if (god) {
						godControls(limitZMax, limitZMin, limitXMax, limitXMin);
					} else {
						marioControls(limitZMax, limitZMin, limitXMax, limitXMin);
					}



				}
				renderer.render(scene, camera);

			}


			function godControls(limitZMax, limitZMin, limitXMax, limitXMin) {
				var currentX = controls.getObject().position.x;
				var currentZ = controls.getObject().position.z;



				var time = performance.now();
				var delta = (time - prevTime) / 1000;

				velocity.x -= velocity.x * 10.0 * delta;
				velocity.z -= velocity.z * 10.0 * delta;

				velocity.y -= 9.8 * 100.0 * delta; // 100.0 = mass

				if (moveForward) velocity.z -= 2000.0 * delta;
				if (moveBackward) velocity.z += 2000.0 * delta;

				if (moveLeft) velocity.x -= 2000.0 * delta;
				if (moveRight) velocity.x += 2000.0 * delta;

				if (currentX > limitXMax) {
					velocity.x = Math.max(0, velocity.x);
					controls.getObject().position.x = limitXMax;
				}
				if (currentX < limitXMin) {
					velocity.x = Math.min(0, velocity.x);
					controls.getObject().position.x = limitXMin;
				}
				if (currentZ > limitZMax) {
					velocity.z = Math.max(0, velocity.z);
					controls.getObject().position.z = limitZMax;
				}
				if (currentZ < limitZMin) {
					velocity.z = Math.min(0, velocity.z);
					controls.getObject().position.z = limitZMin;
				}

				controls.getObject().translateX(velocity.x * delta);
				controls.getObject().translateY(velocity.y * delta);
				controls.getObject().translateZ(velocity.z * delta);

				if (controls.getObject().position.y < 500) {

					velocity.y = 0;
					controls.getObject().position.y = 500;

					canJump = true;

				}

				prevTime = time;


			}

			function marioControls(limitZMax, limitZMin, limitXMax, limitXMin) {

				var currentX = controls.getObject().position.x;
				var currentZ = controls.getObject().position.z;

				/*raycaster.ray.origin.copy(controls.getObject().position);
				raycaster.ray.origin.y -= 20 * meter;
				raycaster.setFromCamera(controls.getDirection(), camera);
				var intersections = raycaster.intersectObjects(objects);*/


				raycaster.ray.origin.copy(controls.getObject().position);

				var dir = controls.getDirection(new THREE.Vector3(0, 0, 0)).clone();

				raycaster.ray.direction.copy(dir);

				var intersections = raycaster.intersectObjects(objects);
				var collision = false;

				//Check infront of player
				for (var i = 0; i < intersections.length; i++) {
					if (intersections[i].object.name) {
						var name = intersections[i].object.name;
						//console.log('OBJECT! : ' + intersections[i].distance);
						if (intersections[i].distance < 25) {
							collision = true;
							controls.getObject().position.x = (Math.sign(dir.x) * -5) + controls.getObject().position.x;
							controls.getObject().position.z = (Math.sign(dir.z) * -5) + controls.getObject().position.z;
							//intersections[i].object.material.color.set(0xff0000);
						}
					}
				};
				//rotate dir
				var axis = new THREE.Vector3(0, 1, 0);
				var angle = Math.PI / 2;
				dir.applyAxisAngle(axis, angle);
				raycaster.ray.direction.copy(dir);
				intersections = raycaster.intersectObjects(objects);
				//Check infront of player
				for (var i = 0; i < intersections.length; i++) {
					if (intersections[i].object.name) {
						var name = intersections[i].object.name;
						//console.log('OBJECT! : ' + intersections[i].distance);
						if (intersections[i].distance < 5) {
							collision = true;
							controls.getObject().position.x = (Math.sign(dir.x) * -5) + controls.getObject().position.x;
							controls.getObject().position.z = (Math.sign(dir.z) * -5) + controls.getObject().position.z;
							//intersections[i].object.material.color.set(0xff0000);
						}
					}
				};
				//rotate dir
				var axis = new THREE.Vector3(0, 1, 0);
				var angle = -Math.PI;
				dir.applyAxisAngle(axis, angle);
				raycaster.ray.direction.copy(dir);
				intersections = raycaster.intersectObjects(objects);
				//Check infront of player
				for (var i = 0; i < intersections.length; i++) {
					if (intersections[i].object.name) {
						var name = intersections[i].object.name;
						//console.log('OBJECT! : ' + intersections[i].distance);
						if (intersections[i].distance < 5) {
							collision = true;
							controls.getObject().position.x = (Math.sign(dir.x) * -5) + controls.getObject().position.x;
							controls.getObject().position.z = (Math.sign(dir.z) * -5) + controls.getObject().position.z;
							//intersections[i].object.material.color.set(0xff0000);
						}
					}
				};


				var isOnObject = intersections.length > 0;

				var time = performance.now();
				var delta = (time - prevTime) / 1000;

				velocity.x -= velocity.x * 10.0 * delta;
				velocity.z -= velocity.z * 10.0 * delta;

				velocity.y -= 9.8 * 100.0 * delta; // 100.0 = mass

				if (!collision) {
					if (moveForward) velocity.z -= 400.0 * delta;
					if (moveBackward) velocity.z += 400.0 * delta;

					if (moveLeft) velocity.x -= 400.0 * delta;
					if (moveRight) velocity.x += 400.0 * delta;
				}

				/*if (isOnObject === true) {
					velocity.y = Math.max(0, velocity.y);

					canJump = true;
				}*/

				if (currentX > limitXMax) {
					velocity.x = Math.max(0, velocity.x);
					controls.getObject().position.x = limitXMax;
				}
				if (currentX < limitXMin) {
					velocity.x = Math.min(0, velocity.x);
					controls.getObject().position.x = limitXMin;
				}
				if (currentZ > limitZMax) {
					velocity.z = Math.max(0, velocity.z);
					controls.getObject().position.z = limitZMax;
				}
				if (currentZ < limitZMin) {
					velocity.z = Math.min(0, velocity.z);
					controls.getObject().position.z = limitZMin;
				}

				controls.getObject().translateX(velocity.x * delta);
				controls.getObject().translateY(velocity.y * delta);
				controls.getObject().translateZ(velocity.z * delta);

				if (controls.getObject().position.y < (marioHeight)) {

					velocity.y = 0;
					controls.getObject().position.y = (marioHeight);

					canJump = true;
				}

				prevTime = time;
			};

			var floor_1_hidden = false;

			function hideFloor(_floorNumber) {
				scene.traverse(function(node) {
					if (node instanceof THREE.Mesh) {
						if (node.name) {
							var floorNumber = node.name.substring(0, 1);
							if (floorNumber === String(_floorNumber)) {
								console.log('Found a floor');
								node.visible = false;
							}
						}
					} else if (node instanceof THREE.Object3D) {
						if (node.name) {
							var floorNumber = node.name.substring(0, 1);
							if (floorNumber === String(_floorNumber)) {
								console.log('Found a floor');
								node.visible = false;
							}
						}
					}
				});
				floor_1_hidden = true;
			}

			function showFloor(_floorNumber) {
				scene.traverse(function(node) {
					if (node instanceof THREE.Mesh) {
						if (node.name) {
							var floorNumber = node.name.substring(0, 1);
							if (floorNumber === String(_floorNumber)) {
								console.log('Found a floor');
								node.visible = true;
							}
						}
					} else if (node instanceof THREE.Object3D) {
						if (node.name) {
							var floorNumber = node.name.substring(0, 1);
							if (floorNumber === String(_floorNumber)) {
								console.log('Found a floor');
								node.visible = true;
							}
						}
					}
				});
				floor_1_hidden = false;
			}

			function changeFloorVisibility() {
				if (floor_1_hidden) {
					showFloor('1');
				} else if (!floor_1_hidden) {
					hideFloor('1');
				}

			}




			function initKeyStrokes() {
				var onKeyDown = function(event) {

					switch (event.keyCode) {

						case 105:
							moveToPosition(100, 0, 0);
							break;

						case 191:
							//goToPosition(-49.80, marioHeight, -942.95);
							processJSONRoute("route1.json")
							break;
							//go to position from sales to shopfloor to lorry to customer press1
						case 49:
							processJSONRoute("routeGetItems.json")
							break;

							//press 2
						case 50:
							processJSONRoute("routeItemsArrive.json")
							break;
							//goToPosition(-49.80, marioHeight, -942.95);
							//	processJSONRoute("routeItemsArrive.json")
							//	break;
							// press 3 for processing route
						case 51:
							processJSONRoute("routeProcessing.json")
							break;
							//  4 for locked route
						case 52:
							processJSONRoute("routeLockedLoop.json")
							break;
							// 5 for functional test
						case 53:
							processJSONRoute("routeFunctional.json")
							break;
							// 6 for data erasure
						case 54:
							processJSONRoute("routeDataErasure.json")
							break;
							// 7 for value est
						case 55:
							processJSONRoute("routeValueEst.json")
							break;
							// 8 for blind bidding
						case 56:
							processJSONRoute("routeBlindBid.json")
							break;
							// 9 for sold
						case 57:
							processJSONRoute("routeSold.json")
							break;
							// 0 for complete
						case 48:
							processJSONRoute("routeComplete.json")
							break;
							//	case 88: // key x
							//goToPosition(-49.80, marioHeight, -942.95);
							// processJSONRoute("routeProcessing.json")
							//	break;

							//	case 67: //c
							//goToPosition(-49.80, marioHeight, -942.95);
							//	processJSONRoute("routeLockedLoop.json")
							//	break;

							//	case 86: //v
							//goToPosition(-49.80, marioHeight, -942.95);
							//		processJSONRoute("routeFunctional.json")
							//			break;
							//		case 66: //b
							//goToPosition(-49.80, marioHeight, -942.95);
							//		processJSONRoute("routeDataErasure.json")
							//			break;

							//			case 70: //f
							//goToPosition(-49.80, marioHeight, -942.95);
							//				processJSONRoute("routeValueEst.json")
							//			break;
							//				case 71: //g
							//goToPosition(-49.80, marioHeight, -942.95);
							//			processJSONRoute("routeBlindBid.json")
							//			break;
							//				case 75:
							//goToPosition(-49.80, marioHeight, -942.95);
							//				processJSONRoute("routeSold.json")
							//			break;
							//	case 72: //h
							//goToPosition(-49.80, marioHeight, -942.95);
							//		processJSONRoute("routeComplete.json")
							//	break;


						case 80:
							changeHeight();
							break;
							//1
						case 49:
							changeFloorVisibility();
							break;
						case 66:
							fakeAddBox();
							break;

						case 78:
							fakeMovedBox(1, 1, 1);
							break;


						case 38: // up
						case 87: // w
							moveForward = true;
							break;

						case 37: // left
						case 65: // a
							moveLeft = true;
							break;

						case 40: // down
						case 83: // s
							moveBackward = true;
							break;

						case 39: // right
						case 68: // d
							moveRight = true;
							break;
						case 33: // d
							god = true;
							controlsEnabled = true;
							break;
						case 34: // d
							god = false;
							controlsEnabled = true;
							break;

						case 32: // space
							if (canJump === true && !god) velocity.y += 300;
							canJump = false;
							break;

					}

				};

				var onKeyUp = function(event) {

					switch (event.keyCode) {

						case 38: // up
						case 87: // w
							moveForward = false;
							break;

						case 37: // left
						case 65: // a
							moveLeft = false;
							break;

						case 40: // down
						case 83: // s
							moveBackward = false;
							break;

						case 39: // right
						case 68: // d
							moveRight = false;
							break;

					}

				};

				document.addEventListener('keydown', onKeyDown, false);
				document.addEventListener('keyup', onKeyUp, false);

			}
		});
	</script>


</body>

</html>
